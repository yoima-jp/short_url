# 分析機能付き短縮URLサービス

パスワード保護機能と詳細なアクセス分析機能を備えた短縮URLサービスです。

## 機能

### 📋 主要機能
- **短縮URL作成**: 長いURLを短いURLに変換
- **パスワード保護**: 管理画面へのアクセスをパスワードで保護
- **詳細分析**: アクセス情報の詳細な記録と分析
- **リアルタイムダッシュボード**: グラフ付きの統計情報表示

### 📊 記録する情報
- アクセス時間
- IPアドレス
- ブラウザの種類
- OS情報
- デバイス種別（PC/タブレット/モバイル）
- 表示言語設定
- タイムゾーン
- リファラー情報

### 📈 分析機能
- ブラウザ別アクセス統計
- OS別アクセス統計
- デバイス別アクセス統計
- 日別アクセス推移
- アクセスログの詳細表示

## インストールと起動

### 前提条件
- Node.js (v14以上)
- npm

### セットアップ
1. 依存パッケージのインストール
```bash
npm install
```

2. サーバーの起動
```bash
npm start
```

3. ブラウザで以下にアクセス
```
http://localhost:3000
```

## 使用方法

### 1. 短縮URL作成
1. ホーム画面で短縮したいURLを入力
2. 管理用パスワードを設定
3. 「短縮URLを作成」ボタンをクリック
4. 短縮URLと管理画面URLが表示される

### 2. 短縮URLの使用
- 作成された短縮URLにアクセスすると、設定したURLにリダイレクト
- アクセス情報が自動的に記録される

### 3. 管理画面の確認
1. 管理画面URLにアクセス
2. 設定したパスワードを入力
3. ダッシュボードでアクセス統計とログを確認

## 技術スタック

- **バックエンド**: Node.js + Express
- **データベース**: SQLite3
- **テンプレート**: EJS
- **フロントエンド**: Bootstrap 5 + Chart.js
- **認証**: bcryptjs

## データベース構造

### short_urls テーブル
- `id`: 主キー
- `code`: 短縮コード
- `original_url`: 元のURL
- `password_hash`: ハッシュ化されたパスワード
- `created_at`: 作成日時

### access_logs テーブル
- `id`: 主キー
- `short_url_id`: 短縮URLのID（外部キー）
- `accessed_at`: アクセス日時
- `ip_address`: IPアドレス
- `user_agent`: User-Agent
- `browser`: ブラウザ名
- `os`: OS名
- `device`: デバイス種別
- `language`: 言語設定
- `timezone`: タイムゾーン
- `referrer`: リファラー

## セキュリティ機能

- パスワードのハッシュ化（bcrypt）
- SQLインジェクション対策
- XSS対策（テンプレートエンジンの自動エスケープ）
- HTTPS推奨

## カスタマイズ

### ポート番号の変更
環境変数 `PORT` で変更可能：
```bash
PORT=8080 npm start
```

### データベースの変更
`server.js` のデータベース設定部分を変更することで、MySQL や PostgreSQL にも対応可能

## ライセンス

MIT License

## 注意事項

- 本番環境では必ずHTTPS化してください
- パスワードは安全な場所に保管してください
- 大量アクセスが予想される場合は、適切なサーバー環境を選択してください
